import sys

from PyQt6.QtGui import QColor, QTextCharFormat
from PyQt6.QtWidgets import (
    QApplication,
    QCheckBox,
    QGridLayout,
    QGroupBox,
    QLabel,
    QLineEdit,
    QListWidget,
    QRadioButton,
    QTextEdit,
    QVBoxLayout,
    QWidget,
)


class WeightConverter(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Использование стандартных элементов управления")
        self.setGeometry(400, 200, 600, 300)

        # --- Элементы интерфейса ---
        self.label_input = QLabel("Введите значение веса в граммах:")
        self.input_grams = QLineEdit()
        self.input_grams.setText("10")

        self.result = QTextEdit()
        self.result.setReadOnly(True)

        self.list_units = QListWidget()
        self.list_units.addItems(["Фунт", "Пуд", "Унция", "Драхм", "Гран"])
        self.list_units.setCurrentRow(0)

        # Радиокнопки режима расчета
        self.radio_single = QRadioButton("Единичный расчет")
        self.radio_range = QRadioButton("Расчет для интервала")
        self.radio_single.setChecked(True)

        group_mode = QGroupBox("Режим расчета")
        vbox_mode = QVBoxLayout()
        vbox_mode.addWidget(self.radio_single)
        vbox_mode.addWidget(self.radio_range)
        group_mode.setLayout(vbox_mode)

        # Чекбоксы настройки редактора
        self.check_italic = QCheckBox("Стиль курсив")
        self.check_red = QCheckBox("Цвет красный")
        self.check_italic.setChecked(True)
        self.check_red.setChecked(True)

        group_editor = QGroupBox("Настройка редактора")
        vbox_editor = QVBoxLayout()
        vbox_editor.addWidget(self.check_italic)
        vbox_editor.addWidget(self.check_red)
        group_editor.setLayout(vbox_editor)

        # --- Макет ---
        grid = QGridLayout()
        grid.addWidget(self.label_input, 0, 0)
        grid.addWidget(self.input_grams, 1, 0)
        grid.addWidget(self.result, 0, 1, 3, 1)
        grid.addWidget(self.list_units, 2, 0)
        grid.addWidget(group_mode, 3, 0)
        grid.addWidget(group_editor, 3, 1)
        self.setLayout(grid)

        # --- Сигналы ---
        self.input_grams.textChanged.connect(self.calculate)
        self.list_units.currentRowChanged.connect(self.calculate)
        self.check_italic.stateChanged.connect(self.calculate)
        self.check_red.stateChanged.connect(self.calculate)

        self.calculate()

    def calculate(self):
        try:
            grams = float(self.input_grams.text())
        except ValueError:
            self.result.setPlainText("Некорректный ввод")
            return

        unit = self.list_units.currentItem().text()
        value = self.convert(grams, unit)

        text = f"{grams} граммов = {value:.3f} {unit}"
        self.result.clear()

        cursor = self.result.textCursor()
        fmt = QTextCharFormat()

        if self.check_red.isChecked():
            fmt.setForeground(QColor("red"))
        if self.check_italic.isChecked():
            fmt.setFontItalic(True)

        cursor.mergeCharFormat(fmt)
        cursor.insertText(text)

    def convert(self, grams, unit):
        conversions = {
            "Фунт": grams / 453.592,
            "Пуд": grams / 16380.496,
            "Унция": grams / 28.3495,
            "Драхм": grams / 1.77185,
            "Гран": grams / 0.0647989,
        }
        return conversions.get(unit, 0.0)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = WeightConverter()
    window.show()
    sys.exit(app.exec_())
